# Development Backlog  
  
## Current Sprint  
  
### In Progress  
- Implement asynchronous git operations  
   - Requirements:  
     - ðŸš§ Synchronous local commits on message receipt
     - ðŸš§ Asynchronous remote pushes on configurable interval
     - ðŸš§ Environment-based git configuration
     - ðŸš§ Basic retry mechanism for push failures
   - Components:  
     - ðŸš§ GitProcessor for local commits
     - ðŸš§ GitSyncService for async pushes
     - ðŸš§ Configurable sync interval (.env)
   - Constraints:  
     - ðŸš§ Local commits must be fast and reliable
     - ðŸš§ Push failures shouldn't affect message processing
     - ðŸš§ Git operations must preserve message order
     - ðŸš§ Must handle concurrent operations safely
   - Configuration (.env):
     - ðŸš§ GIT_REPO_URL=https://github.com/user/repo
     - ðŸš§ GIT_BRANCH=main
     - ðŸš§ GIT_USERNAME=username
     - ðŸš§ GIT_ACCESS_TOKEN=token
     - ðŸš§ GIT_SYNC_INTERVAL=300  # seconds
  
### Next Up  
1. Add per-user multi-tenancy  
   - Requirements:  
     - Per-user chat configuration  
     - Independent git repository credentials for each user  
   - Components:  
     - UserConfigurationManager  
     - CommandHandler updates  
   - Constraints:  
     - Secure credential handling  
     - Configuration persistence  
     - Clear feedback for user errors  
  
2. Complete test coverage for existing features  
   - Message types to test:  
     - âœ… Text messages with replies  
     - âœ… Images with captions  
     - âœ… Documents with metadata  
     - âœ… Audio files  
     - âœ… Voice messages  
     - âœ… Stickers  
   - Test levels needed:  
     - âœ… Unit: Frame creation and validation  
       - âœ… Fixed TelegramBotEvent tests
         - Updated to use effective_message and effective_user
         - Fixed string handling in fallback args test
         - Improved mock object structure
     - âœ… Mock: Storage operations  
     - âœ… Live: End-to-end message flow  
   - Test infrastructure:  
     - âœ… TestBot implementation  
     - âœ… Mock storage backend  
     - âœ… Test data fixtures  
  
3. âœ… Implement TestBot for command validation  
   - Completed:  
     - âœ… Command sequence validation  
     - âœ… Error handling  
     - âœ… Configuration persistence  
     - âœ… Multi-user interactions  
   - Implementation:  
     - âœ… Command simulation  
     - âœ… Response validation  
     - âœ… State verification  
  
4. Add Twitter Transport for bookmark archival  
   - Requirements:  
     - Authenticate with Twitter API  
     - Poll for new bookmarks periodically  
     - Download tweet content and media  
     - Store in Git with metadata  
     - Remove bookmark after successful storage  
   - Components:  
     - TwitterTransport class  
     - Tweet to DocumentFrame conversion  
     - Media attachment handling  
     - Bookmark management  
   - Constraints:  
     - Must handle Twitter API rate limits  
     - Must verify successful storage before unbookmarking  
     - Must handle network failures gracefully  
     - Must preserve all tweet metadata  
   - Storage Format:  
     - tweets/  
       - YYYY-MM-DD/  
         - tweet_id.json (metadata)  
         - media/ (attachments)  
  
## Future Work  
  
### Features  
- [ ] Add multi-tenant support for group chats  
  - Requirements:  
    - Bot configuration via slash commands  
    - Per-group chat configuration  
    - Multiple git repository support  
    - User authorization management  
  - Commands:  
    - /start - Initialize bot in group  
    - /config - Configure git repository  
    - /status - Show current settings  
  - Components:  
    - MultiTenantCoordinator  
  - Constraints:  
    - Secure credential handling  
    - Clear access controls  
    - Configuration persistence  
  
- [ ] Add log rotation and summarization  
   - Requirements:  
     - Daily rotation of messages.jsonl  
     - Archive old logs by date  
     - Maintain consistent git history  
     - Generate daily summaries  
   - Components:  
     - Log rotation workflow  
     - Message sessionization script  
     - Summary generation  
     - Archive management  
   - Schedule:  
     - Run daily at midnight UTC  
     - Process previous day's messages  
     - Generate daily statistics  
   - Outputs:  
     - archives/YYYY-MM-DD/messages.jsonl  
     - summaries/YYYY-MM-DD/  
       - sessions.json (conversation threads)  
       - statistics.json (message counts, types)  
       - topics.json (extracted topics)  
       - participants.json (active users)  
  
- [ ] Add support for topic branching (by forwarding a message)  
- [ ] Add support for message editing  
- [ ] Add support for message deletion  
- [ ] Add support for pinned messages  
- [ ] Add support for channel posts  
- [ ] Add support for inline keyboards  
- [ ] Add support for message reactions  
- [ ] Add support for message threads (supergroups)  
- [ ] Add support for message search  
  
- [ ] Add link expansion and archival  
   - Requirements:  
     - Detect URLs in messages  
     - Download webpage content as PDF  
     - Save complete webpage with assets  
     - Store in Git with metadata  
     - Handle various content types appropriately  
   - Components:  
     - LinkDetector class  
     - WebpageArchiver class  
     - Content type handlers  
     - Download management  
   - Constraints:  
     - Must handle large webpages gracefully  
     - Must preserve webpage styling and assets  
     - Must handle network failures  
     - Must respect robots.txt and rate limits  
   - Storage Format:  
     - links/  
       - YYYY-MM-DD/  
         - domain/  
           - webpage_id/  
             - metadata.json  
             - content.pdf  
             - complete/  
  
### Improvements  
- [ ] Optimize media file storage  
- [ ] Add compression for large files  
- [ ] Improve error recovery  
- [ ] Add rate limiting  
- [ ] Add message batching  
- [ ] Add periodic storage cleanup  
- [ ] Add storage statistics  
  
### Technical Debt  
- [ ] Clean up old implementation files  
- âœ… Reorganize test structure  
- âœ… Add comprehensive logging  
- [ ] Add performance metrics  
- [ ] Add monitoring hooks  
- âœ… Clean up and refactor transport code
  - Completed:
    - Split telegram transport into factory and transport classes
    - Extracted common frame handling logic to base class
    - Standardized logging levels and messages
    - Added proper event handling
    - Improved test organization with unit, mock, and live tests
    - Fixed command handling and registration
  - Components added:
    - TelegramBotTransport and TelegramUserTransport
    - TelegramTransportFactory
    - EventHandler base class
    - Comprehensive test suite
  - Benefits achieved:
    - Reduced code duplication
    - More reliable tests
    - Cleaner logging
    - Better error handling
    - Easier maintenance
- [ ] Enhance operational logging
  - Requirements:
    - Add structured logging with consistent metadata
    - Implement correlation IDs for message tracking
    - Add performance metrics in logs
    - Standardize log levels across components
    - Add component tracing
  - Components:
    - LoggingMiddleware for correlation
    - MetricsLogger for performance
    - StructuredLogFormatter
    - TraceContext manager
  - Benefits:
    - Better debugging capabilities
    - Performance tracking
    - Cross-component tracing
    - Easier log aggregation
- [ ] Move MessageReceiver from tests to library
  - Requirements:
    - Extract from test_telegram_interaction.py
    - Generalize for production use
    - Add proper error handling
    - Add configuration options
  - Components:
    - MessageReceiver base class
    - Transport-specific implementations
    - Message validation framework
  - Benefits:
    - Reusable message verification
    - Consistent handling across transports
    - Better testing infrastructure
    - Simplified test code
- âœ… Standardize test synchronization
  - Completed:
    - Replaced sleep-based waits with proper async/await
    - Added proper event handling in transports
    - Improved test reliability
    - Added proper command registration and handling
  - Benefits achieved:
    - More reliable tests
    - Better async handling
    - Cleaner test code
    - Proper event-based architecture
- [ ] Implement proper dependency injection
  - Requirements:
    - Extract interface definitions
    - Create DI container
    - Configure component lifecycle
    - Add factory methods
  - Components:
    - ServiceContainer
    - ComponentFactory
    - LifecycleManager
    - ConfigurationProvider
  - Benefits:
    - Better testability
    - Cleaner component boundaries
    - Easier configuration
    - More flexible architecture
- [ ] Add proper error recovery mechanisms
  - Requirements:
    - Define error categories
    - Implement retry strategies
    - Add circuit breakers
    - Improve error reporting
  - Components:
    - RetryManager
    - CircuitBreaker
    - ErrorClassifier
    - RecoveryStrategy
  - Benefits:
    - Better system resilience
    - Clearer error handling
    - Improved reliability
    - Better user experience
- [ ] Complete test coverage matrix  
  - Requirements:  
    - âœ… All message types covered in unit tests  
    - âœ… All error conditions covered in mock tests  
    - Live tests: All supported message types  
  - Test Structure:  
    - âœ… Unit: Core logic and data structures  
    - âœ… Mock: External service interactions  
    - Live: End-to-end workflows  
  - Coverage Goals:  
    - Unit tests: 100% coverage  
    - Mock tests: All error conditions  
    - Live tests: All supported message types  
- [ ] Implement pydanticAI throughout codebase  
  - Requirements:  
    - Convert all data models to pydanticAI  
    - Add type validation everywhere  
    - Implement serialization/deserialization  
  - Components:  
    - Message models  
    - Frame models  
    - Configuration models  
    - Transport models  
  - Benefits:  
    - Runtime type safety  
    - Automatic validation  
    - Better IDE support  
    - Cleaner serialization  
- [ ] Expand documentation  
  - Code Documentation:  
    - Docstrings for all classes  
    - Type hints everywhere  
    - Usage examples  
    - Architecture diagrams  
  - User Documentation:  
    - Setup guides  
    - Configuration reference  
    - Message type support  
    - Storage format specs  
  - Developer Documentation:  
    - Contributing guidelines  
    - Test writing guide  
    - Architecture decisions  
    - Data flow diagrams  
  
### Documentation  
- [ ] Update documentation  
- [ ] Add API documentation  
- [ ] Add deployment guide  
- [ ] Add troubleshooting guide  
- [ ] Add message format specification  
- [ ] Add storage format specification  
- [ ] Add configuration guide  
  
## Known Issues  
- [ ] Voice messages saved with incorrect extension  
- [ ] Large files cause memory pressure